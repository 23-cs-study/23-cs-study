## 프로세스 동기화

- 정의) 여러 개의 프로세스나 스레드가 공유 자원을 사용할 때, 경쟁 상태를 막기 위한(데이터의 무결성과 일관성을 보장하기 위한) 기법
- 관련 용어)
    - 경쟁 상태(Race Condition)
        - 정의) 둘 이상의 프로세스가 동시에 공유데이터에 접근할 때 누가 언제 수행되느냐에 따라 결과 바뀌는 상황
        - 예시) 스풀러 디렉터리
        - 방지 조건)
            1. 상호 배제 제공해 어느 두 프로세스도 동시에 임계구역에 있지 못하게 함
            2. CPU 개수나 속도에 대한 가정을 하지 않음
            3. 임계구역 밖의 프로세스는 다른 프로세스를 block시키면 안 됨 (임계구역에 들어가려는 다른 프로세스 막으면 안되서)
            4. 임계구역에 들어가려고 무한히 기다리는 프로세스 없어야 함
    - 상호 배제(Mutual Exclusion)
        - 정의) 한 프로세스가 공유데이터 읽거나 쓰고 있으면 다른 프로세스들은 똑같은 일을 수행하지 못하도록 하는 것
    - 임계 구역(Critical Region)
        - 정의) 공유메모리에 접근하는 프로그램의 코드 부분.
            - 공유메모리 그 자체 아님.
    - 바쁜 대기(Busy Waiting)
        - 정의) 변수가 특정 값이 될 때까지 계속 검사하는 것
        - 특징)
            - CPU 시간이 낭비되기에 기다리는 시간이 짧을 것으로 예상될 때만 사용함
            - 스핀 락 : 바쁜 대기를 사용하는 락

## 바쁜 대기 쓰는 상호배제

### 1) 인터럽트 끄기 → 비추천(권한 남용)

- 정의) 임계구역에 진입한 직후 모든 인터럽트를 비활성화하고, 떠나기 직전 다시 활성화함
    - 인터럽트 비활성화하면 process switch가 일어나지 않아서 상호배제가 제공됨
- 단점) 사용자 프로세스에게 인터럽트를 껐다 켤 수 있는 권한 주는 거라 바람직 x

### 2) 락 변수 사용(Lock Variables) → 실패(조건 1_상호배제 x)

- 락 변수 : 임계구역에 프로세스가 있고 없고를 나타내는 공유변수.
    - 0이면 임계구역에 프로세스 없음.
    - 1이면 임계구역에 프로세스 있음.
- 정의) 임계구역 들어가기 전에 락 변수를 살펴봄.
    - 0 → 1로 변경하고 임계 영역에 들어감.
    - 1 → 0이 될 때까지 기다림
- 단점) Lock 검사 후 값 변경하는 사이에 스위치 일어나면 상호배제 깨짐

### 3) 엄격한 교대(Turn) → 실패(조건 3_x)

- Turn 변수 : 임계구역에 진입할 순번 나타내는 공유변수.
    - 0이면 A차례
    - 1이면 B차례
- 정의) 임계구역 들어가기 전에 turn 변수를 살펴봄.
    - A
        
        ```c
        while(true) {
        	while (turn!=0); // 조건 거짓(turn=0)이면 바로 빠져나감
        	critical_region();
        	turn = 1;
        	noncritical_region();
        }
        ```
        
        - 0 → 1로 변경하고 임계 영역에 들어감.
        - 1 → 0이 될 때까지 기다림
    - B
        
        ```c
        while(true) {
        	while (turn!=1); // 조건 거짓(turn=1)이면 바로 빠져나감
        	critical_region();
        	turn = 0;
        	noncritical_region();
        }
        ```
        
        - 1 → 0로 변경하고 임계 영역에 들어감.
        - 0 → 1이 될 때까지 기다림
- 장점) 조건1_상호배제 제공함
- 단점) 조건3 위반
    - 비임계구역의 프로세스가 다른 프로세스를 차단함
    - 예시)
        - B가 임계구역 실행 후 turn=0으로 변경함
        - A는 임계구역 실행 후 turn=1로 변경함
        - B는 비임계구역 실행 중임
        - A가 B보다 먼저 임계구역 실행을 원한다면?
            - A는 B가 다시 임계구역 실행해서 turn을 0으로 변경해줄 때까지 block됨

### 4) Peterson의 해법 → 성공(Turn 변형)

- 정의)

### 5) TSL 명령 (Lock + 하드웨어)

- 정의)

## 바쁜 대기 안 쓰는 상호배제

### 1) Sleep and Wakeup

### 2) 세마포어

### 3) 뮤텍스

### 4) 모니터
