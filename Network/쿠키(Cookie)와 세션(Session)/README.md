# 쿠키와 세션

TCP/IP를 기반으로한 현대의 네트워크 시스템은 전 세계 누구와도 컴퓨터를 이용해 통신을 할 수 있게 만들어 주었습니다. 덕분에 우리는 방구석에 앉아서 누군가가 만들어놓은 편리한 사이트들을 브라우저를 이용하여 자유롭게 넘나들 수 있게 되었죠. 그런데 웹 서핑을 하다보면 문득 **“이 수많은 컴퓨터 중에 내가 ‘나’라는 걸 어떻게 아는 걸까?”**라는 질문을 하게 됩니다. 아니라구요? 

![쿠키](./%EC%BF%A0%ED%82%A4.png)

그렇다면, 이런 그림은 지겹도록 보셨겠죠? 이걸 도대체 왜 자꾸 허용해달라고 요청하는지 궁금하지는 않으셨나요? 

오늘은 서버가 클라이언트를 식별하는 방법들인 쿠키와 세션에 대해서 알아봅시다.

# 배경

쿠키와 세션은 HTTP 프로토콜의 약점을 보완하기 위해서 등장한 개념입니다(HTTP 프로토콜은 [이전글](https://velog.io/@ksk0605/GET-%EB%A9%94%EC%84%9C%EB%93%9C%EC%99%80-POST-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%A0%9C%EB%8C%80%EB%A1%9C-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0)을 참고해주세요). HTTP 프로토콜은 클라이언트와 서버 간의 요청과 응답을 처리하는 프로토콜이지만, 이전의 요청과 상태 정보를 기억하지 못합니다. 이를 우리는 **‘connectionless’, ‘stateless’** 하다라고 부릅니다. 

쉽게 말해 쇼핑몰 사이트에서 A유저가 장바구니에 물건을 담아봤자 수많은 HTTP요청 중 어떤 것이 A유저의 것인지 알 수 없다면 소용이 없게되는 상황이 생긴다는 것이죠. 따라서, 사용자의 상태 정보를 유지하고 관리하기 위해 세션과 쿠키라는 기술이 등장하게 되었습니다.

> **connectionless**  
클라이언트가 요청을 한 후 응답을 받으면 그 연결을 끊어 버리는 특징. HTTP는 먼저 클라이언트가 request를 서버에 보내면, 서버는 클라이언트에게 요청에 맞는 response를 보내고 접속을 끊는 특성이 있다. 헤더에 keep-alive라는 값을 줘서 커넥션을 재활용하는데 HTTP1.1에서는 이것이 디폴트다. HTTP가 tcp위에서 구현되었기 때문에 (tcp는 연결지향,udp는 비연결지향) 네트워크 관점에서 keep-alive는 옵션으로 connectionless의 연결비용을 줄이는 것을 장점으로 비연결지향이라 한다.
> 

> **stateless**  
통신이 끝나면 상태를 유지하지 않는 특징. 쿠키와 세션은 위의 두 가지 특징을 해결하기 위해 사용. 쿠키와 세션을 사용했을 경우, 한 번 로그인을 하면 어떠한 방식에 의해서 그 사용자에 대한 인증을 유지하게 됌.

그렇다면 이제 쿠키와 세션이 무엇인지 자세히 알아봅시다. 

# 쿠키

쿠키는 상태 정보를 저장하고 유지하기 위한 기술이라고 말씀드렸죠? 쿠키의 특징은 이 정보를 바로 **클라이언트 측에서 저장**한다는 것 입니다. 더욱 정확하게는 브라우저가 그 역할을 담당하고 있죠. 그래서 우리는 동일한 사이트라 하더라도 크롬에서는 자동로그인이 되지만 엣지에서는 다시 로그인을 해야하는 상황을 쉽게 겪을 수 있습니다.

![쿠키의 동작(1).png](./%EC%BF%A0%ED%82%A4%EC%9D%98%20%EB%8F%99%EC%9E%91(1).png)

클라이언트는 서버에 요청을 보낼 때, 서버는 쿠키라는 작은 데이터 조각을 클라이언트에게 전송합니다. 클라이언트는 이 쿠키를 저장하고, 이후에 서버에 요청을 보낼 때마다 이 쿠키를 함께 전송함으로서 내가 아이유 유저라는 것을 증명하는 것 이죠. 

![쿠키의동작(2).png](./%EC%BF%A0%ED%82%A4%EC%9D%98%EB%8F%99%EC%9E%91(2).png)

그렇다면 이제 서버는 쉽게 HTTP 요청만을 보고서 어떤 사용자가 접근을 시도하고 있는지 알 수 있습니다. 이 쿠키에는 사용자 인증이 유효한 시간을 명시할 수 있으며, 유효 시간이 정해지면 브라우저가 종료되어도 인증이 유지된다는 특징이 있습니다.

# 세션

반면에 세션은 **서버가 그 클라이언트의 상태 정보를 저장**하여 클라이언트를 구분하는 기술입니다. 

![세션의동작(1).png](./%EC%84%B8%EC%85%98%EC%9D%98%EB%8F%99%EC%9E%91(1).png)

세션은 클라이언트가 서버에 최초로 요청을 보내면 서버는 클라이언트에게 고유한 세션 ID를 부여하고, 이 ID를 이용하여 세션 정보를 유지합니다. 이때 세션 ID는 쿠키를 이용해서 저장하게 됩니다.

![세션의동작(2).png](./%EC%84%B8%EC%85%98%EC%9D%98%EB%8F%99%EC%9E%91(2).png)

 클라이언트가 다시 요청을 보낼 때마다 서버는 이 ID를 확인하여 해당 클라이언트의 세션 정보를 찾아 사용합니다. 이렇게 함으로써 서버는 쉽게 특정 클라이언트의 상태 정보를 계속 유지할 수 있게 됩니다. 사용자에 대한 정보를 서버에 두기 때문에 쿠키보다 보안에 좋다는 장점은 있지만, 사용자가 많아질수록 서버 메모리를 많이 차지하게 됩니다. 즉 동접자 수가 많은 서버일 수록 서버에 부담은 더욱 커지게 되고 자연스레 성능저하가 있을 수 밖에 없죠. 

# 쿠키와 세션의 차이

세션과 쿠키는 모두 사용자 상태 정보를 저장하고 유지하기 위한 기술이지만, 세션은 서버 측에서 해당 정보를 저장하고, 쿠키는 클라이언트 측에서 저장한다는 것이 가장 큰 차이점입니다. 이러한 차이점 때문에 단순한 요청에는 서버를 거치지 않는 쿠키가 더 빠를 수 밖에 없죠. 그 대신 앞서 말한 것 처럼 보안의 이점을 가져갈 수 있는 것이죠.

또한, 세션은 브라우저를 종료하면 상태 정보가 소멸되지만, 쿠키는 만료 기간이 지나기 전까지 계속해서 유지된다는 특징도 있습니다. 세션도 물론 만료시간을 설정할 수 있지만 브라우저를 꺼버리면 만료시간에 관계없이 상태정보가 삭제되어버립니다. 

세션과 쿠키는 각각의 특징에 따라 적절한 상황에서 사용하는 것이 좋습니다. 예를 들어, 로그인 상태 유지와 같은 중요한 정보는 세션을 이용하여 보안성을 높일 수 있으며, 사용자의 장바구니 정보와 같은 간단한 정보는 쿠키를 이용하여 유지하는 방법을 택할 수 있겠죠.

# 마무리

토큰과 세션은 모두 유용하고 지금도 많이 사용되는 기술입니다. 다만 최근에는 앞서말한 세션의 서버부담과 같은 단점들을 보완하고자 (서버는 곧 돈이니까요ㅎ) 토큰 기반 인증 방식이 많이 사용되는 추세입니다. 평소 많이들 사용해보기는 하지만 제대로는 알지 못하는 대표적인 내용 중 하나인 세션과 토큰의 차이점도 조만간 포스트 해보겠습니다. 오늘도 감사합니다!

# Reference

- [https://interconnection.tistory.com/74](https://interconnection.tistory.com/74)
- [https://code-lab1.tistory.com/298](https://code-lab1.tistory.com/298)